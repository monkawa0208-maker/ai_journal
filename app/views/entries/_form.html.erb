<%= form_with model: entry, local: true, html: { class: "entry-form" } do |f| %>
  <% if entry.errors.any? %>
    <div id="error_explanation" class="form-errors" role="alert">
      <h2><%= entry.errors.count %>件のエラーがあります</h2>
      <ul>
        <% entry.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="form-field">
    <%= f.label :posted_on, "日付", class: "form-label" %>
    <%= f.date_field :posted_on,
                     value: entry.posted_on || Date.current,
                     required: true,
                     class: "form-input" %>
  </div>

  <div class="form-field">
    <%= f.label :title, "タイトル", class: "form-label" %>
    <%= f.text_field :title,
                     required: true,
                     maxlength: 100,
                     autofocus: true,
                     class: "form-input" %>
  </div>

  <div class="form-field">
    <%= f.label :content, "本文", class: "form-label" %>
    <%= f.text_area :content,
                    rows: 12,
                    required: true,
                    maxlength: 10_000,
                    class: "form-textarea" %>
  </div>

  <div class="form-field">
    <%= f.label :image, "画像（任意）", class: "form-label" %>
    <%= f.file_field :image,
                     accept: "image/png,image/jpg,image/jpeg",
                     class: "form-input" %>
    <% if entry.image.attached? %>
      <div class="form-image-preview">
        <%= image_tag entry.image.variant(resize_to_limit: [600, 600]).processed,
                      alt: "#{entry.title.presence || '投稿'}の画像プレビュー" %>
      </div>
    <% end %>
    <p class="field-hint">5MB未満のPNG/JPG画像をアップロードできます。</p>
  </div>

  <div class="form-actions">
    <%= f.submit "保存する", class: "button primary" %>
    <%= link_to "一覧に戻る", entries_path, class: "button secondary" %>
  </div>
<% end %>
