<main class="entries-index" data-controller="entry-tabs">
  <div class="content-wrapper">
    <!-- タブナビゲーション -->
    <div class="entry-tabs-container">
      <button type="button" 
              class="entry-tab-button active" 
              data-entry-tabs-target="tabButton"
              data-action="click->entry-tabs#switchTab"
              data-tab="entries">
        一覧表示
      </button>
      <button type="button" 
              class="entry-tab-button" 
              data-entry-tabs-target="tabButton"
              data-action="click->entry-tabs#switchTab"
              data-tab="calendar">
        カレンダー
      </button>
    </div>

    <section class="entry-detail-section tab-content" data-entry-tabs-target="tabContent" data-tab="entries">
      <div class="entry-detail-card">
        <!-- 検索バー -->
        <div class="entry-search">
          <%= form_with url: entries_path, method: :get, local: true, class: "entry-search-form" do |f| %>
            <%= f.text_field :search, 
                             value: params[:search],
                             placeholder: "タイトルまたは本文で検索...",
                             class: "entry-search-input" %>
            <%= button_tag type: "submit", class: "entry-search-button" do %>
              🔍
            <% end %>
            <% if params[:search].present? %>
              <%= link_to "クリア", entries_path, class: "entry-search-clear" %>
            <% end %>
          <% end %>
        </div>

        <% if @recent_entries.present? %>
          <h2 class="detail-section-title">
            <% if params[:search].present? %>
              検索結果（<%= @recent_entries.count %>件）
            <% end %>
          </h2>
          
          <div class="recent-entries-list">
            <% @recent_entries.each do |entry| %>
              <%= link_to entry_path(entry), class: "recent-entry-item-link" do %>
                <article class="recent-entry-item">
                  <div class="recent-entry-header">
                    <time class="recent-entry-date" datetime="<%= entry.posted_on.iso8601 %>">
                      <%= entry.posted_on.strftime("%Y年%m月%d日") %>
                    </time>
                    <% if entry.image.attached? %>
                      <div class="recent-entry-image">
                        <% if entry.image.variable? %>
                          <%= image_tag entry.image.variant(resize_to_limit: [150, 150]).processed,
                                        alt: "#{entry.title.presence || '日記'}の画像",
                                        class: "recent-entry-thumbnail" %>
                        <% else %>
                          <%= image_tag entry.image,
                                        alt: "#{entry.title.presence || '日記'}の画像",
                                        class: "recent-entry-thumbnail" %>
                        <% end %>
                      </div>
                    <% end %>
                  </div>
                  <h3 class="recent-entry-title"><%= entry.title %></h3>
                  <div class="recent-entry-content">
                    <%= simple_format(truncate(entry.content, length: 100, omission: "...")) %>
                  </div>
                </article>
              <% end %>
            <% end %>
          </div>
        <% else %>
          <div class="empty-detail">
            <% if params[:search].present? %>
              <div class="empty-icon">🔍</div>
              <h3>検索結果が見つかりませんでした</h3>
              <p>「<%= params[:search] %>」に一致する日記はありません。</p>
              <%= link_to "すべての日記を表示", entries_path, class: "button primary" %>
            <% else %>
              <div class="empty-icon">📝</div>
              <h3>まだ投稿がありません</h3>
              <p>今日から英語日記を始めましょう！最初の投稿を書いて、英語力を向上させていきましょう。</p>
              <%= link_to "最初の投稿を書く", new_entry_path, class: "button primary" %>
            <% end %>
          </div>
        <% end %>
      </div>
    </section>

    <section class="calendar-section tab-content hidden" data-entry-tabs-target="tabContent" data-tab="calendar">
      <div class="calendar-card">
        <div id="fullcalendar" 
             data-controller="calendar"
             data-calendar-entries-url-value="<%= entries_path(format: :json) %>">
        </div>
      </div>
    </section>
  </div>
</main>
